Clase #3

select * from producto;
select * from pedido;
select * from pago;

SELECT 
PRODUCTO.
ANIO,
VENTAS,
LAG(VENTAS) OVER ( PARTITION BY PRODUCTO ORDER BY ANIO ASC) VENTAS ANTERIORES, 
VENTAS-LAG(VENTAS) OVER ( PARTITION BY PRODUCTO ORDER BY ANIO ASC) CRECIMIENTO,
LEAD(VENTAS) OVER ( PARTITION BY PRODUCTO ORDER BY ANIO ASC) VENTAS_ POSTERIOR 
FROM (
SELECT PR.NOMBRE PRODUCTO,DP.CANTIDAD*D.PRECIO_UNIDAD VENTAS, EXTRACT(YEAR FROM P.FECHA_ENTREGA) ANIO 
FROM PEDIDO P
INNER JOIN DETALLE_PEDIDO DP
ON P.CODIGO_PEDIDO-DP.CODIGO_PEDIDO
INNER JOIN PRODUCTO PR
ON DP.CODIGO_PRODUCTO=PR.CODIGO_PRODUCTO
WHERE UPPER(P.ESTADO)= 'ENTREGADO'
)

4 MEJORES CLIENTES

SELECT * FROM CLIENTE

SELECT CLIENTE,VENTAS,NIVEL,
CASE WHEN NIVEL=1 THEN  'CATEGORIA A'
WHEN NIVEL=2 THEN 'CATEGORIA B'
WHEN NIVEL=3 THEN 'CATEGORIA C'
WHEN NIVEL=4 THEN 'CATEGORIA D'
END CATEGORIA
FROM (
SELECT CLIENTE, VENTAS,
NTILE(4) OVER (ORDER BY VENTAS DESC) AS NIVEL
FROM (
SELECT CL.NOMBRE_CLIENTE CLIENTE, SUM(DP.CANTIDAD*DP.PRECIO_UNIDAD) VENTAS 
FROM PEDIDO P
INNER JOIN DETALLE_PEDIDO DP
ON P.CODIGO_PEDIDO=DP.CODIGO_PEDIDO
INNER JOIN PRODUCTO PR 
ON DP.CODIGO_PRODUCTO=PR.CODIGO_PRODUCTO
INNER JOIN CLIENTE CL
ON P.CODIGO_CLIENTE=CL.CODIGO_CLIENTE
WHERE UPPER(P.ESTADO)='ENTREGADO'
GROUP BY CL.NOMBRE_CLIENTE
)
)